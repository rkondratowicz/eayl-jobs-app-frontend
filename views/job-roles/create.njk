{% extends "layout.njk" %}

{% block navbarActions %}
<a href="/job-roles" class="btn btn-ghost btn-sm">
    <i data-lucide="arrow-left" class="h-4 w-4 mr-1"></i>
    Back to List
</a>
{% endblock %}

{% block header %}
<div class="mb-8">
    <h1 class="text-4xl font-bold text-center mb-2">{{ title }}</h1>
    <p class="text-center text-base-content/70">{{ description }}</p>
</div>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    {% if errors.length > 0 %}
    <!-- Error Summary -->
    <div role="alert" class="alert alert-error mb-6">
        <i data-lucide="alert-circle" class="h-5 w-5"></i>
        <div>
            <h3 class="font-bold">Please correct the following errors:</h3>
            <ul class="list-disc ml-4 mt-2">
                {% for error in errors %}
                <li>{{ error.message }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    <!-- Form Card -->
    <form method="POST" action="/job-roles/create" class="card bg-base-100 shadow-xl" novalidate>
        <div class="card-body space-y-6">
            <!-- Basic Information Section -->
            <div>
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                    <i data-lucide="info" class="h-6 w-6"></i>
                    Basic Information
                </h2>
                
                <div class="space-y-4">
                    <!-- Role Name -->
                    <fieldset class="fieldset md:col-span-2">
                        <legend class="fieldset-legend">Role Name <span class="text-error">*</span></legend>
                        <input 
                            type="text" 
                            name="roleName" 
                            value="{{ formData.roleName or '' }}"
                            placeholder="e.g., Senior Software Engineer" 
                            class="input validator {% if errors | selectattr('field', 'equalto', 'roleName') | list | length > 0 %}input-error{% endif %}"
                            required
                        />
                        {% set roleNameError = errors | selectattr('field', 'equalto', 'roleName') | first %}
                        {% if roleNameError %}
                        <div class="label">
                            <span class="label-text-alt text-error">{{ roleNameError.message }}</span>
                        </div>
                        {% endif %}
                    </fieldset>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Location -->
                        <fieldset class="fieldset">
                            <legend class="fieldset-legend">Location <span class="text-error">*</span></legend>
                            <input 
                                type="text" 
                                name="location" 
                                value="{{ formData.location or '' }}"
                                placeholder="e.g., Belfast, UK" 
                                class="input validator {% if errors | selectattr('field', 'equalto', 'location') | list | length > 0 %}input-error{% endif %}"
                                required
                            />
                            {% set locationError = errors | selectattr('field', 'equalto', 'location') | first %}
                            {% if locationError %}
                            <div class="label">
                                <span class="label-text-alt text-error">{{ locationError.message }}</span>
                            </div>
                            {% endif %}
                        </fieldset>

                        <!-- Capability -->
                        <fieldset class="fieldset">
                            <legend class="fieldset-legend">Capability <span class="text-error">*</span></legend>
                            <input 
                                type="text" 
                                name="capability" 
                                value="{{ formData.capability or '' }}"
                                placeholder="e.g., Engineering" 
                                class="input validator {% if errors | selectattr('field', 'equalto', 'capability') | list | length > 0 %}input-error{% endif %}"
                                required
                            />
                            {% set capabilityError = errors | selectattr('field', 'equalto', 'capability') | first %}
                            {% if capabilityError %}
                            <div class="label">
                                <span class="label-text-alt text-error">{{ capabilityError.message }}</span>
                            </div>
                            {% endif %}
                        </fieldset>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Band -->
                        <fieldset class="fieldset">
                            <legend class="fieldset-legend">Band <span class="text-error">*</span></legend>
                            <select 
                                name="band" 
                                class="select validator {% if errors | selectattr('field', 'equalto', 'band') | list | length > 0 %}select-error{% endif %}"
                                required
                            >
                                <option value="" disabled {% if not formData.band %}selected{% endif %}>Select a band</option>
                                <option value="Junior" {% if formData.band === 'Junior' %}selected{% endif %}>Junior</option>
                                <option value="Mid" {% if formData.band === 'Mid' %}selected{% endif %}>Mid</option>
                                <option value="Senior" {% if formData.band === 'Senior' %}selected{% endif %}>Senior</option>
                                <option value="Principal" {% if formData.band === 'Principal' %}selected{% endif %}>Principal</option>
                                <option value="Lead" {% if formData.band === 'Lead' %}selected{% endif %}>Lead</option>
                            </select>
                            {% set bandError = errors | selectattr('field', 'equalto', 'band') | first %}
                            {% if bandError %}
                            <div class="label">
                                <span class="label-text-alt text-error">{{ bandError.message }}</span>
                            </div>
                            {% endif %}
                        </fieldset>

                        <!-- Status -->
                        <fieldset class="fieldset">
                            <legend class="fieldset-legend">Status <span class="text-error">*</span></legend>
                            <select 
                                name="status" 
                                class="select validator {% if errors | selectattr('field', 'equalto', 'status') | list | length > 0 %}select-error{% endif %}"
                                required
                            >
                                <option value="Draft" {% if formData.status === 'Draft' or not formData.status %}selected{% endif %}>Draft</option>
                                <option value="Open" {% if formData.status === 'Open' %}selected{% endif %}>Open</option>
                                <option value="Closed" {% if formData.status === 'Closed' %}selected{% endif %}>Closed</option>
                            </select>
                            {% set statusError = errors | selectattr('field', 'equalto', 'status') | first %}
                            {% if statusError %}
                            <div class="label">
                                <span class="label-text-alt text-error">{{ statusError.message }}</span>
                            </div>
                            {% endif %}
                        </fieldset>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Closing Date -->
                        <fieldset class="fieldset">
                            <legend class="fieldset-legend">Closing Date <span class="text-error">*</span></legend>
                            <input 
                                type="date" 
                                name="closingDate" 
                                value="{{ formData.closingDate.toISOString().split('T')[0] if formData.closingDate else '' }}"
                                class="input validator {% if errors | selectattr('field', 'equalto', 'closingDate') | list | length > 0 %}input-error{% endif %}"
                                required
                            />
                            {% set closingDateError = errors | selectattr('field', 'equalto', 'closingDate') | first %}
                            {% if closingDateError %}
                            <div class="label">
                                <span class="label-text-alt text-error">{{ closingDateError.message }}</span>
                            </div>
                            {% endif %}
                        </fieldset>

                        <!-- Number of Open Positions -->
                        <fieldset class="fieldset">
                            <legend class="fieldset-legend">Open Positions <span class="text-error">*</span></legend>
                            <input 
                                type="number" 
                                name="numberOfOpenPositions" 
                                value="{{ formData.numberOfOpenPositions or '' }}"
                                placeholder="e.g., 2" 
                                min="1" 
                                max="999"
                                class="input validator {% if errors | selectattr('field', 'equalto', 'numberOfOpenPositions') | list | length > 0 %}input-error{% endif %}"
                                required
                            />
                            {% set positionsError = errors | selectattr('field', 'equalto', 'numberOfOpenPositions') | first %}
                            {% if positionsError %}
                            <div class="label">
                                <span class="label-text-alt text-error">{{ positionsError.message }}</span>
                            </div>
                            {% endif %}
                        </fieldset>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Job Details Section -->
            <div>
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                    <i data-lucide="file-text" class="h-6 w-6"></i>
                    Job Details
                </h2>

                <div class="space-y-4">
                    <!-- Job Specification -->
                    <fieldset class="fieldset">
                        <legend class="fieldset-legend">Job Specification <span class="text-error">*</span></legend>
                        <textarea 
                            name="jobSpec" 
                            rows="6"
                            placeholder="Describe the role, requirements, and key qualifications..." 
                            class="textarea validator {% if errors | selectattr('field', 'equalto', 'jobSpec') | list | length > 0 %}textarea-error{% endif %}"
                            minlength="10"
                            required
                        >{{ formData.jobSpec or '' }}</textarea>
                        <span class="label">Minimum 10 characters</span>
                        {% set jobSpecError = errors | selectattr('field', 'equalto', 'jobSpec') | first %}
                        {% if jobSpecError %}
                        <div class="label">
                            <span class="label-text-alt text-error">{{ jobSpecError.message }}</span>
                        </div>
                        {% endif %}
                    </fieldset>

                    <!-- Responsibilities -->
                    <fieldset class="fieldset">
                        <legend class="fieldset-legend">Responsibilities <span class="text-error">*</span></legend>
                        <textarea 
                            name="responsibilities" 
                            rows="6"
                            placeholder="List the main responsibilities and duties..." 
                            class="textarea validator {% if errors | selectattr('field', 'equalto', 'responsibilities') | list | length > 0 %}textarea-error{% endif %}"
                            minlength="10"
                            required
                        >{{ formData.responsibilities or '' }}</textarea>
                        <span class="label">Minimum 10 characters</span>
                        {% set responsibilitiesError = errors | selectattr('field', 'equalto', 'responsibilities') | first %}
                        {% if responsibilitiesError %}
                        <div class="label">
                            <span class="label-text-alt text-error">{{ responsibilitiesError.message }}</span>
                        </div>
                        {% endif %}
                    </fieldset>
                </div>
            </div>
        </div>

        <!-- Card Actions -->
        <div class="card-actions justify-end p-6 bg-base-200 gap-2">
            <a href="/job-roles" class="btn btn-ghost">
                <i data-lucide="x" class="h-4 w-4 mr-1"></i>
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                <i data-lucide="check" class="h-4 w-4 mr-1"></i>
                Create Job Role
            </button>
        </div>
    </form>
</div>

<script>
    // Initialize Lucide icons
    lucide.createIcons();
</script>
{% endblock %}
